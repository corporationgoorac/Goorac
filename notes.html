<style>
    :root { 
        --bg: #000; 
        --accent: #0095f6; 
        --border: #262626; 
        --bubble-bg: #262626;
    }
    
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    
    body { 
        background: var(--bg); 
        color: #fff; 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
        height: 100vh; 
        display: flex; 
        flex-direction: column; 
        overflow: hidden; 
    }

    /* Header Styling */
    header { 
        padding: 15px 20px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        z-index: 10;
        padding-top: env(safe-area-inset-top, 15px);
    }
    .close-btn { font-size: 28px; font-weight: 300; cursor: pointer; }
    .share-btn { 
        background: #385185; 
        color: white; 
        padding: 8px 20px; 
        border-radius: 20px; 
        font-weight: 600; 
        font-size: 0.9rem;
        opacity: 0.5; 
        pointer-events: none; 
        transition: 0.2s;
    }
    .share-btn.active { 
        background: #0095f6;
        opacity: 1; 
        pointer-events: auto; 
    }

    /* Centered Editor Space */
    .editor-space { 
        flex: 1; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center; 
        position: relative;
    }

    .note-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        width: 100%;
    }

    /* The Instagram Note Bubble */
    .note-bubble-preview {
        background: var(--bubble-bg);
        color: white;
        padding: 12px 20px;
        border-radius: 22px;
        min-width: 140px;
        max-width: 220px;
        text-align: center;
        position: relative;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        z-index: 2;
        transition: background 0.3s;
    }

    /* Tail dots for the bubble */
    .note-bubble-preview::after {
        content: ''; position: absolute; bottom: -8px; left: 50%;
        transform: translateX(-50%); width: 14px; height: 14px;
        background: inherit; border-radius: 50%;
    }
    .note-bubble-preview::before {
        content: ''; position: absolute; bottom: -18px; left: 45%;
        width: 7px; height: 7px; background: inherit;
        border-radius: 50%; opacity: 0.7;
    }

    #display-text { font-size: 1rem; display: block; word-wrap: break-word; line-height: 1.3; }

    #music-tag {
        display: flex; align-items: center; justify-content: center;
        gap: 5px; font-size: 0.8rem; font-weight: 600; margin-top: 6px;
        color: #a8a8a8;
    }

    /* Profile Circle */
    .profile-circle {
        width: 110px; height: 110px; border-radius: 50%;
        background: #1c1c1c; border: 2px solid #000;
        overflow: hidden; position: relative;
    }
    .profile-circle img { width: 100%; height: 100%; object-fit: cover; }

    /* Hidden Input Overlay */
    #note-input {
        position: absolute; top: 0; left: 0; width: 100%; height: 50%;
        opacity: 0; z-index: 5;
    }

    /* Tools Area */
    .tools-container {
        display: flex; gap: 20px; margin-top: 25px;
    }

    .tool-btn {
        width: 44px; height: 44px; border-radius: 50%;
        border: 1px solid #333; display: flex;
        align-items: center; justify-content: center;
        cursor: pointer; transition: 0.2s;
    }
    .tool-btn:active { transform: scale(0.9); }
    .tool-btn svg { width: 20px; height: 20px; fill: #ff0050; }

    /* Bottom Info */
    .footer-info {
        padding: 20px; text-align: center; color: #a8a8a8;
        font-size: 0.85rem; display: flex; align-items: center;
        justify-content: center; gap: 5px;
    }
</style>

<body>
    <header>
        <div class="close-btn" onclick="history.back()">âœ•</div>
        <div class="rainbow-orb" style="width:28px; height:28px; background: radial-gradient(circle, #f09433, #e6683c, #dc2743, #bc1888); border-radius:50%;"></div>
        <div class="share-btn" id="share-btn" onclick="publishNote()">Share</div>
    </header>

    <div class="editor-space" onclick="document.getElementById('note-input').focus()">
        <div class="note-container">
            <div class="note-bubble-preview" id="preview-bubble">
                <span id="display-text">New day, new note...</span>
                <div id="music-tag" style="display:none;">
                    <svg viewBox="0 0 24 24" style="width:14px; fill:#a8a8a8;"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                    <span id="song-name"></span>
                </div>
            </div>
            
            <div class="profile-circle">
                <img id="user-pfp" src="https://via.placeholder.com/110" alt="Profile">
            </div>

            <input type="text" id="note-input" maxlength="60" autofocus>
        </div>

        <div class="tools-container">
            <div class="tool-btn" onclick="pickMusic()">
                <svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
            </div>
            <div class="tool-btn">
                <svg viewBox="0 0 24 24" style="fill:#a43ff2;"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            </div>
        </div>
    </div>

    <div class="footer-info">
        <svg viewBox="0 0 24 24" style="width:16px; fill:#a8a8a8;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
        <span>Share with followers you follow back</span>
    </div>

    <song-picker id="music-picker"></song-picker>

    <script>
        // Use your existing Firebase logic here
        // Update user profile picture on load
        firebase.auth().onAuthStateChanged(user => {
            if(user && user.photoURL) document.getElementById('user-pfp').src = user.photoURL;
        });

        const input = document.getElementById('note-input');
        const display = document.getElementById('display-text');
        const shareBtn = document.getElementById('share-btn');

        input.oninput = () => {
            display.innerText = input.value || "New day, new note...";
            shareBtn.classList.toggle('active', input.value.trim().length > 0);
        };
        
        // Music Picker Integration
        const picker = document.getElementById('music-picker');
        function pickMusic() { picker.open(); }
        
        picker.addEventListener('song-selected', (e) => {
            const song = e.detail;
            document.getElementById('music-tag').style.display = 'flex';
            document.getElementById('song-name').innerText = song.trackName;
        });
    </script>
</body>
